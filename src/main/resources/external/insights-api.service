#
[Unit]
Description=insights-api: Insights API

[Service]
Type=forking

# WARNING: environment.rc and config files can override any variable defined here.
# WARNING: Do not guess, but read wrapper.sh script instead.

Environment=JAVA_HOME="/usr/lib/jvm/java-17-amazon-corretto"
Environment=APP_JAVA_OPTS="-server -Xms3200m -Xmx3200m -XX:+HeapDumpOnOutOfMemoryError -Xlog:gc*:file=%h/log/insights-api.GC.log"
Environment=CLASSPATH=""
Environment=APP_ENTRY_POINT="-jar %JAR_FILE%"
Environment=APP_ARGS=""
Environment=SPRING_CONFIG_ADDITIONAL_LOCATION="file:%h/config.local.yaml"
Environment=APP_HOME="%h/current"
Environment=APP_BASE="%h"

WorkingDirectory=%h/current
ExecStartPre=/bin/bash -c 'while ! pg_isready -q -h localhost -p 5432; do sleep $((RANDOM % 5)); done'
ExecStart=/bin/bash -c "\"%h/bin/insights-api\" start"
ExecStop=/bin/bash  -c "\"%h/bin/insights-api\" stop"

[Install]
WantedBy=default.target
